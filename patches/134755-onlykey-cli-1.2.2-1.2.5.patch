From 1ea5faa3913ebf2826f0dae68b5a4a93d8b5872e Mon Sep 17 00:00:00 2001
From: "Wael M. Nasreddine" <wael.nasreddine@gmail.com>
Date: Wed, 18 Aug 2021 19:54:37 -0700
Subject: [PATCH 1/2] python3Packages.onlykey-solo-python: init at 0.0.28

---
 .../onlykey-solo-python/default.nix           | 34 +++++++++++++++++++
 pkgs/top-level/python-packages.nix            |  2 ++
 2 files changed, 36 insertions(+)
 create mode 100644 pkgs/development/python-modules/onlykey-solo-python/default.nix

diff --git a/pkgs/development/python-modules/onlykey-solo-python/default.nix b/pkgs/development/python-modules/onlykey-solo-python/default.nix
new file mode 100644
index 00000000000..ddeb9670dc2
--- /dev/null
+++ b/pkgs/development/python-modules/onlykey-solo-python/default.nix
@@ -0,0 +1,34 @@
+{ buildPythonPackage
+, click
+, ecdsa
+, fetchPypi
+, fido2
+, intelhex
+, lib
+, pyserial
+, pyusb
+, requests
+}:
+
+buildPythonPackage rec {
+  pname = "onlykey-solo-python";
+  version = "0.0.28";
+
+  src = fetchPypi {
+    inherit pname version;
+    sha256 = "sha256-Mbi5So2OgeXjg4Fzg7v2gAJuh1Y7ZCYu8Lrha/7PQfY=";
+  };
+
+  propagatedBuildInputs = [ click ecdsa fido2 intelhex pyserial pyusb requests ];
+
+  # no tests
+  doCheck = false;
+
+  meta = with lib; {
+    homepage = "https://github.com/trustcrypto/onlykey-solo-python";
+    description = "Python library for OnlyKey with Solo FIDO2";
+    maintainers = with maintainers; [ kalbasit ];
+    license = licenses.asl20;
+  };
+}
+
diff --git a/pkgs/top-level/python-packages.nix b/pkgs/top-level/python-packages.nix
index 181837dc996..e9e9d9de945 100644
--- a/pkgs/top-level/python-packages.nix
+++ b/pkgs/top-level/python-packages.nix
@@ -4728,6 +4728,8 @@ in {
 
   onkyo-eiscp = callPackage ../development/python-modules/onkyo-eiscp { };
 
+  onlykey-solo-python = callPackage ../development/python-modules/onlykey-solo-python { };
+
   onnx = callPackage ../development/python-modules/onnx { };
 
   openant = callPackage ../development/python-modules/openant { };
-- 
2.31.1


From 1c37932ab36ecd8239b1b6d8a0fe67a93eaac33a Mon Sep 17 00:00:00 2001
From: "Wael M. Nasreddine" <wael.nasreddine@gmail.com>
Date: Wed, 18 Aug 2021 19:54:50 -0700
Subject: [PATCH 2/2] onlykey-cli: update 1.2.2 -> 1.2.5

---
 pkgs/tools/security/onlykey-cli/default.nix | 17 +++++++++++++----
 1 file changed, 13 insertions(+), 4 deletions(-)

diff --git a/pkgs/tools/security/onlykey-cli/default.nix b/pkgs/tools/security/onlykey-cli/default.nix
index b342f203b44..cc595771c6b 100644
--- a/pkgs/tools/security/onlykey-cli/default.nix
+++ b/pkgs/tools/security/onlykey-cli/default.nix
@@ -2,18 +2,27 @@
 
 python3Packages.buildPythonApplication rec {
   pname = "onlykey-cli";
-  version = "1.2.2";
+  version = "1.2.5";
 
   src = python3Packages.fetchPypi {
     inherit version;
     pname = "onlykey";
-    sha256 = "1qkbgab5xlg7bd0jfzf8k5ppb1zhib76r050fiaqi5wibrqrfwdi";
+    sha256 = "sha256-7Pr1gXaPF5mctGxDciKKj0YDDQVFFi1+t6QztoKqpAA=";
   };
 
+  propagatedBuildInputs = with python3Packages; [
+    aenum
+    cython
+    ecdsa
+    hidapi
+    onlykey-solo-python
+    prompt_toolkit
+    pynacl
+    six
+  ];
+
   # Requires having the physical onlykey (a usb security key)
   doCheck = false;
-  propagatedBuildInputs =
-    with python3Packages; [ hidapi aenum six prompt_toolkit pynacl ecdsa cython ];
 
   meta = with lib; {
     description = "OnlyKey client and command-line tool";
-- 
2.31.1

