From 85add4ff3c94b1971435956e277dc5cc2306a37c Mon Sep 17 00:00:00 2001
From: "Wael M. Nasreddine" <wael.nasreddine@gmail.com>
Date: Thu, 2 Mar 2023 09:49:09 -0800
Subject: [PATCH 1/2] libagent: hardcode the path to gpgconf

---
 pkgs/development/python-modules/libagent/default.nix | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/pkgs/development/python-modules/libagent/default.nix b/pkgs/development/python-modules/libagent/default.nix
index 3bb8962e5a3a5..5886c694e337f 100644
--- a/pkgs/development/python-modules/libagent/default.nix
+++ b/pkgs/development/python-modules/libagent/default.nix
@@ -5,6 +5,7 @@
 , cryptography
 , ed25519
 , ecdsa
+, gnupg
 , semver
 , mnemonic
 , unidecode
@@ -30,6 +31,12 @@ buildPythonPackage rec {
     sha256 = "sha256-RISAy0efdatr9u4CWNRGnlffkC8ksw1NyRpJWKwqz+s=";
   };
 
+  # hardcode the path to gpgconf in the libagent library
+  preBuild = ''
+    substituteInPlace libagent/gpg/keyring.py \
+      --replace "util.which('gpgconf')" "'${gnupg}/bin/gpgconf'"
+  '';
+
   propagatedBuildInputs = [
     unidecode
     backports-shutil-which

From 8ab57a61d9a513ee7743915448469442dee876b1 Mon Sep 17 00:00:00 2001
From: "Wael M. Nasreddine" <wael.nasreddine@gmail.com>
Date: Thu, 2 Mar 2023 10:59:14 -0800
Subject: [PATCH 2/2] libagent: hardcode the path gpg-connect-agent

---
 pkgs/development/python-modules/libagent/default.nix | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/pkgs/development/python-modules/libagent/default.nix b/pkgs/development/python-modules/libagent/default.nix
index 5886c694e337f..b478394c6a316 100644
--- a/pkgs/development/python-modules/libagent/default.nix
+++ b/pkgs/development/python-modules/libagent/default.nix
@@ -34,7 +34,8 @@ buildPythonPackage rec {
   # hardcode the path to gpgconf in the libagent library
   preBuild = ''
     substituteInPlace libagent/gpg/keyring.py \
-      --replace "util.which('gpgconf')" "'${gnupg}/bin/gpgconf'"
+      --replace "util.which('gpgconf')" "'${gnupg}/bin/gpgconf'" \
+      --replace "'gpg-connect-agent'" "'${gnupg}/bin/gpg-connect-agent'"
   '';
 
   propagatedBuildInputs = [
